<!DOCTYPE html>
<html lang="en">
<head>
    <script type="module" src="https://md-block.verou.me/md-block.js"></script>
    <style>
        body {
            background: linear-gradient(to right, white, lightblue);
            text-align: left;
        }
        @keyframes blink {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }

        #dots {
            animation-name: blink;
            animation-duration: 1.4s;
            animation-iteration-count: infinite;
            animation-fill-mode: both;
        }

        #responseContainer {
            max-width: 800px;
            overflow: hidden;
        }
    </style>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabroom Summarizer</title>
</head>
<body>

    <h1>TABROOM SUMMARIZER</h1>

    Enter the following information for the results you want to summarize.<br><br>

    (To find the tournament ID for a tournament, click on the tournament on Tabroom.com and find the 5-digit tourn_id from the URL)<br><br>

    (Need a suggestion for a tournament ID? Try 27074 (Cal Berkeley 2024). Submit a blank school name to display a list of schools with results.)<br><br>

    <form id="myForm">
        <label for="tournamentNumber">Tournament Number:</label>
        <input type="text" id="tournamentNumber" name="tournamentNumber" required>
        <br><br>
        <label for="schoolName">School Name:</label>
        <input type="text" id="schoolName" name="schoolName" required>
        <br><br>
        <button type="button" onclick="submitForm()">Submit</button>
    </form>

    <div id="responseContainer">
        <md-block>
            ## Recently-generated tournament results:
            ```json
            +---------------+------------------------------------------------------------+-------+------+
            | Tournament ID | Tournament Name                                            | State | Year |
            +---------------+------------------------------------------------------------+-------+------+
            | 19857         | Badger Ridge Hamilton Middle School Parliamentary Debate 1 | WI    | 2022 |
            +---------------+------------------------------------------------------------+-------+------+
            | 24637         | The Hilltopper Classic                                     | WI    | 2022 |
            +---------------+------------------------------------------------------------+-------+------+
            | 27074         | Cal Invitational UC Berkeley                               | CA    | 2024 |
            +---------------+------------------------------------------------------------+-------+------+
            | 27840         | MN Classic Debate Online Oct 7                             | MN    | 2023 |
            +---------------+------------------------------------------------------------+-------+------+
            | 28000         | Three Rivers TOC NIETOC at Upper St Clair                  | PA    | 2024 |
            +---------------+------------------------------------------------------------+-------+------+
            | 28332         | NSDA Taiwan Members Invitational                           | N/A   | 2023 |
            +---------------+------------------------------------------------------------+-------+------+
            | 28357         | CVFL 6 Speech St Francis Catholic High School              | CA    | 2024 |
            +---------------+------------------------------------------------------------+-------+------+
            | 28499         | The Falcon Fright                                          | ID    | 2023 |
            +---------------+------------------------------------------------------------+-------+------+
            | 29117         | The Edina Classic                                          | MN    | 2023 |
            +---------------+------------------------------------------------------------+-------+------+
            | 29796         | USA FORENSICS OLYMPIAD February Open                       | N/A   | 2024 |
            +---------------+------------------------------------------------------------+-------+------+
            | 30799         | Brooklyn Debate League 215                                 | NY    | 2024 |
            +---------------+------------------------------------------------------------+-------+------+
            ```
        </md-block>
    </div>

    <br>You can report issues with this service at <a href="https://github.com/benjmor/tabroom_auto_summarize/issues">the Issues page</a>.

    <script>
        function submitForm() {
            // Update to Loading...
            document.getElementById('responseContainer').innerText = "Loading..."
            // Get form data
            const tournamentNumber = document.getElementById('tournamentNumber').value;
            const schoolName = document.getElementById('schoolName').value;

            // Validate tournament number format
            if (!/^\d{5}$/.test(tournamentNumber)) {
                alert('Please enter a 5-digit number for the Tournament Number.');
                return;
            }

            // Validate school name length
            if (schoolName.length > 50) {
                alert('Please enter a school name with 50 characters or less.');
                return;
            }

            // Create a JSON object with the form data
            const formData = {
                tournament: tournamentNumber,
                school: schoolName
            };

            // Perform a POST request to the API Gateway endpoint
            fetch('https://4wvm0o3xmb.execute-api.us-east-1.amazonaws.com/prod/submit_tournament', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData),
            })
            .then(response => response.json())
            .then(data => {
                // Display the response
                file_content = data['file_content'].replace("Event-by-Event Results", "### Event-by-Event Results") //.replace(/\n/g, '<br>');
                gpt_content = data['gpt_content'].replace(/\n/g, "\n\n"); // more newlines!
                display_md = "<md-block>" + "## Tournament Summary:\n" + file_content + "\n## Prompt passed to ChatGPT:\n" + gpt_content + "\n" + "</md-block>";
                document.getElementById('responseContainer').innerHTML = display_md;
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('responseContainer').innerText = 'Error occurred. Please try again.';
            });
        }
    </script>
    <script>
        document.querySelector('#myForm').addEventListener('submit', function(e) {
            e.preventDefault();

            // Show the loading message
            document.getElementById('loadingMessage').style.display = 'block';

            // Add the dots
            let dots = window.setInterval( function() {
                let wait = document.getElementById("dots");
                if ( wait.innerHTML.length > 3 ) 
                    wait.innerHTML = "";
                else 
                    wait.innerHTML += ".";
            }, 300);
        });
    </script>

</body>
</html>
