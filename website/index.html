<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabroom Summarizer</title>
</head>
<body>

    <h1>Tabroom Summarizer</h1>

    Enter the following information for the results you want to summarize.<br><br>

    <form id="myForm">
        <label for="tournamentNumber">Tournament Number:</label>
        <input type="text" id="tournamentNumber" name="tournamentNumber" required>

        <label for="schoolName">School Name:</label>
        <input type="text" id="schoolName" name="schoolName" required>

        <button type="button" onclick="submitForm()">Submit</button>
    </form>

    <div id="responseContainer"></div>

    <br>You can report issues with this service at <a href="https://github.com/benjmor/tabroom_auto_summarize/issues">the Issues page</a>.

    <script>
        function submitForm() {
            // Get form data
            const tournamentNumber = document.getElementById('tournamentNumber').value;
            const schoolName = document.getElementById('schoolName').value;

            // Validate tournament number format
            if (!/^\d{5}$/.test(tournamentNumber)) {
                alert('Please enter a 5-digit number for the Tournament Number.');
                return;
            }

            // Validate school name length
            if (schoolName.length > 50) {
                alert('Please enter a school name with 50 characters or less.');
                return;
            }

            // Create a JSON object with the form data
            const formData = {
                tournament: tournamentNumber,
                school: schoolName
            };

            // Perform a POST request to the API Gateway endpoint
            fetch('https://4wvm0o3xmb.execute-api.us-east-1.amazonaws.com/prod/submit_tournament', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData),
            })
            .then(response => response.json())
            .then(data => {
                // Display the response
                file_content = data['file_content'];
                gpt_content = data['gpt_content'];
                display_html = "<h2>Tournament Summary:</h2>" + file_content + "<h2>Prompt passed to ChatGPT:</h2>" + gpt_content + "<br>";
                document.getElementById('responseContainer').innerHTML = display_html;
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('responseContainer').innerText = 'Error occurred. Please try again.';
            });
        }
    </script>

</body>
</html>
