<!DOCTYPE html>
<html lang="en">
<head>
    <script type="module" src="https://md-block.verou.me/md-block.js"></script>
    <style>
        body {
            background: linear-gradient(to right, white, lightblue);
            text-align: left;
        }
        @keyframes blink {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }

        #dots {
            animation-name: blink;
            animation-duration: 1.4s;
            animation-iteration-count: infinite;
            animation-fill-mode: both;
        }

        #responseContainer {
            max-width: 800px;
            overflow: hidden;
        }
    </style>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabroom Summary</title>
</head>
<body>

    <h1>TABROOM SUMMARY</h1>

    Enter the following information for the results you want to summarize.<br><br>

    To find the tournament ID for a tournament, click on the tournament on Tabroom.com and find the 5-digit tourn_id from the URL.<br><br>

    Submit a blank school name to display a list of schools with results.<br><br>

    Please <b>SUBMIT</b> these results to your school administrators, newspapers, social media feeds, and other relevant media!<br><br>

    <form id="myForm">
        <label for="tournamentNumber">Tournament Number:</label>
        <input type="text" id="tournamentNumber" name="tournamentNumber" required>
        <br><br>
        <label for="schoolName">School Name:</label>
        <input type="text" id="schoolName" name="schoolName" required>
        <br><br>
        <button type="button" onclick="submitForm()">Submit</button>
    </form>

    <div id="responseContainer">
        <md-block>
            ## Recently-generated tournament results:
            ```json
            +---------------+------------------------------------------------------------+-------+---------------------+
            | Tournament ID |                      Tournament Name                       | State |        Date         |
            +===============+============================================================+=======+=====================+
            | 30799         | Brooklyn Debate League 215                                 |  NY   | 2024-02-15 22:10:00 |
            +---------------+------------------------------------------------------------+-------+---------------------+
            | 30392         | BAUDL Aaron Thomas Memorial Tournament                     |  CA   | 2024-02-03 16:00:00 |
            +---------------+------------------------------------------------------------+-------+---------------------+
            | 29908         | Tall Cotton District Tournament                            |  TX   | 2024-02-22 16:30:00 |
            +---------------+------------------------------------------------------------+-------+---------------------+
            | 29796         | USA FORENSICS OLYMPIAD February Open                       |       | 2024-02-24 14:00:00 |
            +---------------+------------------------------------------------------------+-------+---------------------+
            | 29465         | USC Trojan Invitational                                    |  CA   | 2024-02-23 16:00:00 |
            +---------------+------------------------------------------------------------+-------+---------------------+
            | 29362         | Gracia Burkill Memorial Tournament                         |  MA   | 2023-11-11 12:00:00 |
            +---------------+------------------------------------------------------------+-------+---------------------+
            | 29196         | Warrior Invitational                                       |  SC   | 2024-01-20 13:00:00 |
            +---------------+------------------------------------------------------------+-------+---------------------+
            | 29117         | The Edina Classic                                          |  MN   | 2023-11-11 14:00:00 |
            +---------------+------------------------------------------------------------+-------+---------------------+
            | 28902         | Bingham PF Policy Invitational                             |  UT   | 2024-02-16 22:00:00 |
            +---------------+------------------------------------------------------------+-------+---------------------+
            | 28779         | UNT John S Gossett Memorial High School Tournament         |  TX   | 2023-10-27 18:00:00 |
            +---------------+------------------------------------------------------------+-------+---------------------+
            | 28568         | Coast Forensic League CFL Super Debate 2                   |  CA   | 2024-01-20 16:00:00 |
            +---------------+------------------------------------------------------------+-------+---------------------+
            | 28499         | The Falcon Fright                                          |  ID   | 2023-10-28 12:00:00 |
            +---------------+------------------------------------------------------------+-------+---------------------+
            | 28357         | CVFL 6 Speech St Francis Catholic High School              |  CA   | 2024-02-03 16:00:00 |
            +---------------+------------------------------------------------------------+-------+---------------------+
            | 28356         | CVFL 5 Debate Mira Loma                                    |  CA   | 2023-12-09 16:00:00 |
            +---------------+------------------------------------------------------------+-------+---------------------+
            | 28352         | CVFL 1 Satyaprit Das Debate at Mira Loma                   |  CA   | 2023-09-23 15:00:00 |
            +---------------+------------------------------------------------------------+-------+---------------------+
            | 28342         | Mesa High Jackrabbit Jamboree                              |  AZ   | 2024-02-02 13:00:00 |
            +---------------+------------------------------------------------------------+-------+---------------------+
            | 28332         | NSDA Taiwan Members Invitational                           |       | 2023-10-05 23:00:00 |
            +---------------+------------------------------------------------------------+-------+---------------------+
            | 28291         | 52nd Marshall Univ John Marshall                           |  WV   | 2024-02-08 13:00:00 |
            +---------------+------------------------------------------------------------+-------+---------------------+
            | 28222         | Clear Lake Falcon Classic TFA IQT                          |  TX   | 2023-12-01 20:30:00 |
            +---------------+------------------------------------------------------------+-------+---------------------+
            | 28000         | Three Rivers TOC NIETOC at Upper St Clair                  |  PA   | 2024-02-09 21:00:00 |
            +---------------+------------------------------------------------------------+-------+---------------------+
            | 27840         | MN Classic Debate Online Oct 7                             |  MN   | 2023-10-07 13:00:00 |
            +---------------+------------------------------------------------------------+-------+---------------------+
            | 27697         | 2023 Nova Titan Invitational                               |  FL   | 2023-10-07 12:00:00 |
            +---------------+------------------------------------------------------------+-------+---------------------+
            | 27560         | 2024 Ivy Street Round Robin                                |  GA   | 2024-01-25 14:00:00 |
            +---------------+------------------------------------------------------------+-------+---------------------+
            | 27326         | GGSA Individual Events 2                                   |  CA   | 2023-12-02 16:00:00 |
            +---------------+------------------------------------------------------------+-------+---------------------+
            | 27074         | Cal Invitational UC Berkeley                               |  CA   | 2024-02-17 14:00:00 |
            +---------------+------------------------------------------------------------+-------+---------------------+
            | 24637         | The Hilltopper Classic                                     |  WI   | 2022-09-17 07:00:00 |
            +---------------+------------------------------------------------------------+-------+---------------------+
            | 23456         | BDL April 11 Mini Tournament                               |  NY   | 2022-04-11 21:45:00 |
            +---------------+------------------------------------------------------------+-------+---------------------+
            | 19857         | Badger Ridge Hamilton Middle School Parliamentary Debate 1 |  WI   | 2021-03-19 20:00:00 |
            +---------------+------------------------------------------------------------+-------+---------------------+
            ```
        </md-block>
    </div>

    <br>You can report issues with this service at <a href="https://github.com/benjmor/tabroom_auto_summarize/issues">the Issues page</a>.

    <script>
        function submitForm() {
            // Update to Loading...
            document.getElementById('responseContainer').innerText = "\nLoading...this may take up to 15 seconds for new summary requests...to keep you engaged, here is a joke: How do you catch de fish? With de-bate!"
            // Get form data
            const tournamentNumber = document.getElementById('tournamentNumber').value;
            const schoolName = document.getElementById('schoolName').value;

            // Validate tournament number format
            if (!/^\d{5}$/.test(tournamentNumber) || (tournamentNumber == "00000")) {
                alert('Please enter a valid 5-digit number for the Tournament Number.');
                return;
            }

            // Validate school name length
            if (schoolName.length > 50) {
                alert('Please enter a school name with 50 characters or less.');
                return;
            }

            // Create a JSON object with the form data
            const formData = {
                tournament: tournamentNumber,
                school: schoolName
            };

            // Perform a POST request to the API Gateway endpoint
            fetch('https://4wvm0o3xmb.execute-api.us-east-1.amazonaws.com/prod/submit_tournament', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData),
            })
            .then(response => response.json())
            .then(data => {
                // Display the response
                file_content = data['file_content'].replace("Event-by-Event Results", "### Event-by-Event Results") //.replace(/\n/g, '<br>');
                gpt_content = data['gpt_content'].replace(/\n/g, "\n\n"); // more newlines!
                numbered_list_prompt_content = data['numbered_list_prompt_content']
                display_md = "<md-block>" + "## Tournament Summary:\n" + file_content + 
                             "\n## Prompt passed to ChatGPT:\n" + gpt_content + "\n" + 
                             "\n## Line-by-Line prompt passed to ChatGPT:\n" + numbered_list_prompt_content + "</md-block>";
                document.getElementById('responseContainer').innerHTML = display_md;
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('responseContainer').innerText = 'Error occurred. Please try again.';
            });
        }
    </script>
    <script>
        document.querySelector('#myForm').addEventListener('submit', function(e) {
            e.preventDefault();

            // Show the loading message
            document.getElementById('loadingMessage').style.display = 'block';

            // Add the dots
            let dots = window.setInterval( function() {
                let wait = document.getElementById("dots");
                if ( wait.innerHTML.length > 3 ) 
                    wait.innerHTML = "";
                else 
                    wait.innerHTML += ".";
            }, 300);
        });
    </script>

</body>
</html>
